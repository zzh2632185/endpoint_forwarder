# Claude Request Forwarder Configuration
# 完整配置示例，展示所有可用的配置选项

# 服务器配置
server:
  host: "127.0.0.1"      # 监听地址，默认: localhost
  port: 8087             # 监听端口，默认: 8080

# 路由策略配置
strategy:
  type: "fastest"                  # 路由策略: "priority" (优先级) 或 "fastest" (最快响应)
  fast_test_enabled: true          # 启用快速测试 (仅在 fastest 策略下生效)
  fast_test_cache_ttl: "30s"       # 快速测试结果缓存时间，默认: 3s
  fast_test_timeout: "5s"          # 快速测试超时时间，默认: 1s  
  fast_test_path: "/v1/models"     # 快速测试路径，默认使用健康检查路径

# 重试配置
retry:
  max_attempts: 3        # 最大重试次数，默认: 3
  base_delay: "1s"       # 基础延迟时间，默认: 1s
  max_delay: "30s"       # 最大延迟时间，默认: 30s
  multiplier: 2.0        # 延迟倍数，默认: 2.0

# 健康检查配置
health:
  check_interval: "30s"  # 健康检查间隔，默认: 30s
  timeout: "5s"          # 健康检查超时，默认: 5s
  health_path: "/v1/models"  # 健康检查路径，默认: /v1/models

# 日志配置
logging:
  level: "info"          # 日志级别: debug, info, warn, error，默认: info
  format: "json"         # 日志格式: "json" 或 "text"，默认: text
  
  # 文件日志配置 (可选)
  file_enabled: false            # 是否启用文件日志，默认: false
  file_path: "logs/app.log"      # 日志文件路径，默认: logs/app.log
  max_file_size: "100MB"         # 单个日志文件最大大小，支持: KB, MB, GB，默认: 100MB
  max_files: 10                  # 最多保留的轮转文件数量，默认: 10
  compress_rotated: true         # 是否压缩轮转的旧日志文件，默认: false
  disable_response_limit: true   # 启用文件日志时是否取消响应内容输出限制，默认: false

# 流式传输配置
streaming:
  heartbeat_interval: "30s"  # 心跳间隔，默认: 30s
  read_timeout: "10s"         # 读取超时，默认: 1s
  max_idle_time: "120s"      # 最大空闲时间，默认: 120s

# 全局超时配置
global_timeout: "300s"       # 非流式请求的全局默认超时时间，默认: 300s (5分钟)

# 鉴权配置 (可选)
auth:
  enabled: false             # 是否启用鉴权，默认: false (不鉴权)
  # token: "your-bearer-token"  # Bearer Token，启用鉴权时必须设置

# TUI界面配置,如果部署在服务器上建议设置为 false
tui:
  enabled: true               # 是否启用TUI界面，默认: true
  update_interval: "1s"       # TUI刷新间隔，默认: 1s

# 代理配置 (可选)
proxy:
  enabled: false              # 是否启用代理
  type: "http"               # 代理类型: "http", "https", 或 "socks5"
  
  # 方式一: 完整代理 URL
  # url: "http://proxy.example.com:8080"
  # url: "https://proxy.example.com:8080"
  # url: "socks5://proxy.example.com:1080"
  
  # 方式二: 分别指定主机和端口
  host: "proxy.example.com"   # 代理主机
  port: 8080                  # 代理端口
  
  # 可选的认证信息
  # username: "proxy_user"    # 代理用户名
  # password: "proxy_pass"    # 代理密码

# 端点配置
endpoints:
  # 主要端点 - 其他端点会继承此端点的 token 和 headers (如果未指定)
  - name: "primary"
    url: "https://api.openai.com"
    priority: 1              # 优先级 (数字越小优先级越高)
    timeout: "300s"           # 请求超时时间，如果不设置则使用 global_timeout
    token: "sk-your-openai-api-key"  # API 密钥
    headers:                 # 自定义请求头
      User-Agent: "Claude-Request-Forwarder/1.0"
      X-Custom-Header: "custom-value"

  # 备用端点 1 - 会继承主要端点的 token 和 headers
  - name: "backup1"
    url: "https://api.anthropic.com"
    priority: 2
    timeout: "300s"
    # token 和 headers 会从第一个端点继承

  # 备用端点 2 - 使用不同的 token 和 headers
  - name: "backup2"
    url: "https://api.example.com"
    priority: 3
    timeout: "300s"
    token: "sk-different-api-key"  # 覆盖继承的 token
    headers:
      Authorization: "Bearer custom-token"
      X-API-Version: "2024-01"
      # 其他 headers 仍会从第一个端点继承并与此处合并

  # 本地端点示例
  - name: "local"
    url: "http://localhost:11434"
    priority: 4
    timeout: "300s"
    # 本地服务通常不需要 token